#!/bin/bash

echo "ğŸš€ Setup Bot IncontriEscort - Sistema Completo"
echo "=============================================="

# Installa dipendenze
echo "ğŸ“¦ Installazione dipendenze..."
cd "$(dirname "$0")"
npm install

# Torna alla directory principale
cd ..

# Aggiorna database con nuovi modelli
echo "ğŸ—„ï¸ Aggiornamento database..."
npx prisma db push

# Genera client Prisma
echo "âš™ï¸ Generazione client Prisma..."
npx prisma generate

echo ""
echo "âœ… Setup completato!"
echo ""
echo "ğŸ¤– COMANDI DISPONIBILI:"
echo "======================"
echo ""
echo "ğŸ“– SCRAPING:"
echo "  cd scripts && npm run escort-advisor    # Scraping recensioni da escort-advisor.com"
echo "  cd scripts && npm run bakeca           # Scraping annunci da bakecaincontri.com"
echo ""
echo "ğŸ”„ BUMP AUTOMATICO:"
echo "  cd scripts && npm run bump-once        # Esegue un ciclo di bump"
echo "  cd scripts && npm run bump-daemon      # Avvia bump automatico (daemon)"
echo ""
echo "ğŸŒ WEB:"
echo "  npm run dev                           # Avvia sito web"
echo "  Vai su: http://localhost:3000/incontri-veloci"
echo ""
echo "ğŸ“Š MONITORAGGIO:"
echo "  - Logs bump: controllare console del daemon"
echo "  - Stats database: /api/quick-meetings"
echo "  - Debug: /api/debug/check-cities"
echo ""
echo "âš¡ SISTEMA BUMP:"
echo "==============="
echo "â€¢ 1+1 = 2 giorni di bump giornaliero"
echo "â€¢ 1+3 = 4 giorni di bump giornaliero"  
echo "â€¢ 1+7 = 8 giorni di bump giornaliero"
echo "â€¢ 1x10 = 10 bump notturni (00:00-08:00)"
echo "â€¢ 1x3 = 3 bump notturni (00:00-08:00)"
echo ""
echo "ğŸ¯ FASCE ORARIE DIURNE:"
echo "â€¢ 08:00-09:00, 09:00-10:00, ..., 23:00-00:00"
echo "â€¢ Ogni annuncio ha una fascia assegnata casualmente"
echo "â€¢ Il bump avviene automaticamente nella fascia corretta"
echo ""
echo "ğŸŒ™ BUMP NOTTURNI:"
echo "â€¢ 1x10: ogni 48 minuti tra 00:00-08:00"
echo "â€¢ 1x3: ogni 2h40m tra 00:00-08:00"
echo ""
echo "ğŸ”§ CONFIGURAZIONE:"
echo "=================="
echo "â€¢ Database: PostgreSQL (configurato in .env)"
echo "â€¢ Scraping: Puppeteer headless"
echo "â€¢ Scheduler: node-cron ogni 15 minuti"
echo "â€¢ Cleanup: ogni ora rimuove annunci scaduti"
echo ""
echo "ğŸ“ˆ MONITORAGGIO PERFORMANCE:"
echo "============================"
echo "â€¢ Statistiche ogni 6 ore"
echo "â€¢ Log dettagliati per ogni operazione"
echo "â€¢ Gestione errori e retry automatici"
echo ""
echo "ğŸš¨ IMPORTANTE:"
echo "=============="
echo "â€¢ Avvia SEMPRE il bump-daemon per il funzionamento automatico"
echo "â€¢ Monitora i logs per eventuali errori"
echo "â€¢ Il sistema Ã¨ progettato per funzionare 24/7"
echo "â€¢ Backup regolari del database raccomandati"
echo ""
echo "ğŸ‰ PRONTO PER L'USO!"
